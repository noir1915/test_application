# test_application
Тестовое задание.

*****************************
### Описание задания:

## Стек и тулы:

Java 17, PostgresSQL БД, Spring boot (v3.4.5), API описан с помощью Open API и Swagger, Swagger UI доступен по адресу: `http://localhost:8080/swagger-ui/index.html`, Maven, Реализации слоя кэширования приложения – Redis, миграция таблиц БД через Liquibase, 	логировние через SLF4, Доступ к API аутентифицирован с помощью JWT токена в заголовке HTTP запроса.

## Общие требование к системе:

1.	3 слоя – API, service, DAO
2.	В системе только обычные пользователи (не админы и т.д).
3.	Создаются миграциями. Для обычных пользователей нет операции создания.
4.	У пользователя может быть более одного PHONE_DATA (должен быть как минимум 1).
5.	У пользователя может быть более одного EMAIL_DATA (должен быть как минимум 1).
6.	У пользователя должен быть быть строго один ACCOUNT.
7.	Начальный BALANCE в ACCOUNT указывается при создании пользователя.
8.	BALANCE в ACCOUNT не может уходить в минус ни при каких операциях.
   
Обязательные фичи:

1.	Добавлено кэширование (например на API и на DAO слой).
2.	CREATE (только для определенных внутри пользователя данных), UPDATE операции для пользователя. Пользователь может менять только собственные данные:
a)	может удалить/сменить/добавить email если он не занят другим пользователям
b)	может удалить/сменить/добавить phone если он не занят другим пользователям
c)	остальное менять не может
2.	Реализовать READ операцию для пользователей. Сделать «поиск пользователей» (искать может любой любого) с фильтрацией по полям ниже и пагинацией (size, page/offset): 
a)	Если передана «dateOfBirth», то фильтр записей, где «date_of_birth» больше чем переданный в запросе.
b)	Если передан «phone», то фильтр по 100% сходству.
c)	Если передан «name», то фильтр по like форматом ‘{text-from-request-param}%’
d)	Если передан «email», то фильтр по 100% сходству.
3.	Добавить JWT token (необходимый Claim только USER_ID), механизм получения токена на ваше усмотрение. Имплементировать максимально просто, не стоит усложнять. Аутентификация может быть по email+password, либо по phone+password.
4.	Раз в 30 секунд BALANCE каждого клиента увеличиваются на 10% но не более 207% от начального депозита.
Например:
Было: 100, стало: 110.
Было: 110, стало:121.
…
5.	Сделан функционал трансфера денег от одного пользователя к другому.
Вход: USER_ID (transfer from) – берем у авторизованного из Claim токена, USER_ID (transfer to) из запроса, VALUE (сумма перевода) из запроса.
То есть у того, кто переводит мы списываем эту сумму, у того, кому переводим – добавляем эту сумму.
Жта операция считается «банковской» (высоко-значима), сделана со всеми необходимыми валидациями и потоко-защищена.

Не обязательные фичи (сделаны в минимальном исполнении):

1.	Добавлен swagger (минимальная конфигурация).
 `http://localhost:8080/swagger-ui/index.html`
3.	Добавлено (значимое) логгирование.

Тестирование:
Тесты на покрытие функционала трансфера денег.




## Запуск

* С помощью Maven (в системе должна быть установлена PostgresSQL):
```
./mvnw spring-boot:run
```
Доступные эндпойнты:

* POST `http://localhost:8080/api/v1/auth/login` - аутентификация пользователя по номеру/email или паролю
* После получения и ввода JWT-токена возможны реализации:
* GET `http://localhost:8080/api/v1/users/search` - поиск пользователей с возможностью фильтрации по различным критериям и пагинацией результатов
* GET `http://localhost:8080/api/v1/users/{id}` - получить всю информацию о пользователя по id 
* PUT `http://localhost:8080/api/v1/users/{id}` - обновить пользователя
* DELETE `http://localhost:8080/api/v1/users/{id}` - удалить пользователя

* POST `http://localhost:8080/api/v1/users/{id}/email` - добавить email пользователя
* PUT `http://localhost:8080/api/v1/users/{id}/email` - обновить email пользователя
* DELETE `http://localhost:8080/api/v1/users/{id}/email` - удалить email пользователя

* POST `http://localhost:8080/api/v1/users/{id}/phone` - добавить номер пользователя
* PUT `http://localhost:8080/api/v1/users/{id}/phone` - обновить номер пользователя
* DELETE `http://localhost:8080/api/v1/users/{id}/phone` - удалить номер пользователя
